<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/gfn-icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenNOW</title>
    <link rel="stylesheet" href="/src/styles/main.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <div id="app">
      <!-- Header -->
      <header id="app-header">
        <div class="header-left">
          <nav class="main-nav">
            <a href="#" class="nav-item active" data-view="home">
              <i data-lucide="home" class="nav-icon"></i>
              Home
            </a>
            <a href="#" class="nav-item" data-view="library">
              <i data-lucide="library" class="nav-icon"></i>
              My Library
            </a>
          </nav>
        </div>
        <div class="header-center">
          <div class="search-container">
            <i data-lucide="search" class="search-icon"></i>
            <input type="text" id="search-input" placeholder="Search games..." autocomplete="off" />
            <div id="search-dropdown" class="search-dropdown hidden"></div>
          </div>
        </div>
        <div class="header-right">
          <div class="user-section">
            <button id="login-btn" class="btn btn-primary">Sign In</button>
            <div id="user-menu" class="user-menu hidden">
              <div class="user-info">
                <span id="user-name"></span>
                <div class="tier-info">
                  <span id="user-tier" class="user-tier"></span>
                  <span id="user-time" class="user-time"></span>
                </div>
              </div>
              <button id="logout-btn" class="icon-btn" title="Logout">
                <i data-lucide="log-out"></i>
              </button>
            </div>
          </div>
          <button id="settings-btn" class="icon-btn" title="Settings">
            <i data-lucide="settings"></i>
          </button>
        </div>
      </header>

      <!-- Main Content -->
      <main id="main-content">
        <!-- Home View -->
        <section id="home-view" class="view active">
          <div class="content-section">
            <h2>Featured Games</h2>
            <div id="featured-games" class="games-grid"></div>
          </div>

          <div class="content-section">
            <h2>Recently Added</h2>
            <div id="recent-games" class="games-grid"></div>
          </div>

          <div class="content-section">
            <h2>Free to Play</h2>
            <div id="free-games" class="games-grid"></div>
          </div>
        </section>

        <!-- Library View -->
        <section id="library-view" class="view hidden">
          <div class="library-header">
            <h1>My Library</h1>
            <div class="library-filters">
              <div class="custom-dropdown compact" data-dropdown="store-filter">
                <div class="dropdown-trigger" tabindex="0">
                  <span class="dropdown-text">All Stores</span>
                  <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                </div>
                <div class="dropdown-menu">
                  <div class="dropdown-option selected" data-value="all">All Stores</div>
                  <div class="dropdown-option" data-value="steam">Steam</div>
                  <div class="dropdown-option" data-value="epic">Epic Games</div>
                  <div class="dropdown-option" data-value="ubisoft">Ubisoft</div>
                </div>
              </div>
              <button id="sync-library-btn" class="btn">Sync Library</button>
            </div>
          </div>

          <div class="content-section">
            <h2>Recently Played</h2>
            <div id="recently-played" class="games-grid"></div>
          </div>

          <div class="content-section">
            <h2>My Games</h2>
            <div id="my-games" class="games-grid"></div>
          </div>
        </section>

      </main>

      <!-- Game Detail Modal -->
      <div id="game-modal" class="modal hidden">
        <div class="modal-content">
          <button class="modal-close">&times;</button>
          <div id="game-detail"></div>
        </div>
      </div>

      <!-- Login Modal -->
      <div id="login-modal" class="modal hidden">
        <div class="modal-content login-modal-content">
          <button class="modal-close">&times;</button>
          <h2>Sign In</h2>
          <div class="login-options">
            <button id="nvidia-login-btn" class="btn btn-primary btn-large login-option">
              <i data-lucide="star" class="login-icon"></i>
              Sign in with NVIDIA
            </button>
            <div class="login-divider">
              <span>or</span>
            </div>
            <button id="token-login-btn" class="btn btn-secondary btn-large login-option">
              <i data-lucide="key" class="login-icon"></i>
              Enter Token Manually
            </button>
          </div>
          <div id="token-entry" class="token-entry hidden">
            <p class="token-instructions">
              1. Go to <a href="https://play.geforcenow.com" target="_blank">play.geforcenow.com</a> and sign in<br>
              2. Press F12 to open DevTools<br>
              3. Go to Application > Local Storage<br>
              4. Copy the NVAUTHTOKEN value
            </p>
            <textarea id="token-input" placeholder="Paste your NVAUTHTOKEN here..."></textarea>
            <button id="submit-token-btn" class="btn btn-primary">Submit Token</button>
          </div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
          <button class="modal-close">&times;</button>
          <h2>Settings</h2>
          <div class="settings-form">
            <div class="setting-group">
              <label>Resolution</label>
              <div class="custom-dropdown" data-dropdown="resolution-setting">
                <div class="dropdown-trigger" tabindex="0">
                  <span class="dropdown-text">1920x1080 (1080p)</span>
                  <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                </div>
                <div class="dropdown-menu">
                  <!-- 4:3 / 5:4 Resolutions -->
                  <div class="dropdown-option" data-value="1024x768">1024x768 (4:3)</div>
                  <div class="dropdown-option" data-value="1280x1024">1280x1024 (5:4)</div>
                  <div class="dropdown-option" data-value="1600x1200">1600x1200 (4:3)</div>
                  <!-- 16:9 Standard -->
                  <div class="dropdown-option" data-value="1280x720">1280x720 (720p)</div>
                  <div class="dropdown-option" data-value="1366x768">1366x768 (HD)</div>
                  <div class="dropdown-option" data-value="1600x900">1600x900 (HD+)</div>
                  <div class="dropdown-option selected" data-value="1920x1080">1920x1080 (1080p)</div>
                  <div class="dropdown-option" data-value="2560x1440">2560x1440 (1440p)</div>
                  <div class="dropdown-option" data-value="3840x2160">3840x2160 (4K)</div>
                  <div class="dropdown-option" data-value="5120x2880">5120x2880 (5K)</div>
                  <!-- 16:10 Resolutions -->
                  <div class="dropdown-option" data-value="1280x800">1280x800 (16:10)</div>
                  <div class="dropdown-option" data-value="1440x900">1440x900 (16:10)</div>
                  <div class="dropdown-option" data-value="1680x1050">1680x1050 (16:10)</div>
                  <div class="dropdown-option" data-value="1920x1200">1920x1200 (16:10)</div>
                  <div class="dropdown-option" data-value="2560x1600">2560x1600 (16:10)</div>
                  <div class="dropdown-option" data-value="3840x1600">3840x1600 (16:10)</div>
                  <!-- Ultrawide 21:9 -->
                  <div class="dropdown-option" data-value="2560x1080">2560x1080 (21:9)</div>
                  <div class="dropdown-option" data-value="3440x1440">3440x1440 (21:9 UW)</div>
                  <!-- Super Ultrawide 32:9 -->
                  <div class="dropdown-option" data-value="3840x1080">3840x1080 (32:9)</div>
                  <div class="dropdown-option" data-value="5120x1440">5120x1440 (32:9 UW)</div>
                  <!-- Other -->
                  <div class="dropdown-option" data-value="1112x834">1112x834 (iPad)</div>
                  <div class="dropdown-option" data-value="1680x720">1680x720 (21:9 HD)</div>
                  <div class="dropdown-option" data-value="3456x2160">3456x2160 (16:10 4K)</div>
                  <div class="dropdown-option" data-value="5120x2160">5120x2160 (21:9 5K)</div>
                </div>
              </div>
            </div>
            <div class="setting-group">
              <label>Frame Rate</label>
              <div class="custom-dropdown" data-dropdown="fps-setting">
                <div class="dropdown-trigger" tabindex="0">
                  <span class="dropdown-text">60 FPS</span>
                  <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                </div>
                <div class="dropdown-menu">
                  <div class="dropdown-option" data-value="30">30 FPS</div>
                  <div class="dropdown-option selected" data-value="60">60 FPS</div>
                  <div class="dropdown-option" data-value="120">120 FPS</div>
                  <div class="dropdown-option" data-value="240">240 FPS</div>
                  <div class="dropdown-option" data-value="360">360 FPS</div>
                </div>
              </div>
            </div>
            <div class="setting-group">
              <label>Video Codec</label>
              <div class="custom-dropdown" data-dropdown="codec-setting">
                <div class="dropdown-trigger" tabindex="0">
                  <span class="dropdown-text">H.264 (Best Compatibility)</span>
                  <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                </div>
                <div class="dropdown-menu">
                  <div class="dropdown-option selected" data-value="h264">H.264 (Best Compatibility)</div>
                  <div class="dropdown-option" data-value="av1">AV1 (Best Quality)</div>
                </div>
              </div>
            </div>
            <div class="setting-group">
              <label>Audio Codec</label>
              <div class="custom-dropdown" data-dropdown="audio-codec-setting">
                <div class="dropdown-trigger" tabindex="0">
                  <span class="dropdown-text">Opus (Default)</span>
                  <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                </div>
                <div class="dropdown-menu">
                  <div class="dropdown-option selected" data-value="opus">Opus (Default)</div>
                  <div class="dropdown-option" data-value="opus-stereo">Opus Stereo (macOS)</div>
                </div>
              </div>
            </div>
            <div class="setting-group">
              <label>Max Bitrate: <span id="bitrate-value">Unlimited</span></label>
              <input type="range" id="bitrate-setting" min="20" max="200" value="200" step="10" />
              <div class="bitrate-labels">
                <span>20 Mbps</span>
                <span>Unlimited</span>
              </div>
            </div>
            <div class="setting-group">
              <label>Preferred Region</label>
              <div class="custom-dropdown" data-dropdown="region-setting">
                <div class="dropdown-trigger" tabindex="0">
                  <span class="dropdown-text">Auto (Lowest Ping)</span>
                  <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                </div>
                <div class="dropdown-menu">
                  <div class="dropdown-option selected" data-value="auto">Auto (Lowest Ping)</div>
                </div>
              </div>
            </div>
            <div class="setting-group">
              <label>
                <input type="checkbox" id="telemetry-setting" checked />
                Disable Telemetry
              </label>
            </div>
            <div class="setting-group">
              <label>
                <input type="checkbox" id="discord-setting" />
                Enable Discord Rich Presence
              </label>
            </div>
            <div class="setting-group">
              <label>
                <input type="checkbox" id="discord-stats-setting" />
                Show Stats in Discord (resolution, fps, ms)
              </label>
            </div>
            <div class="setting-group">
              <label>
                <input type="checkbox" id="reflex-setting" checked />
                NVIDIA Reflex (Low Latency Mode)
              </label>
            </div>
            <div class="setting-group">
              <label>Custom Proxy (optional)</label>
              <input type="text" id="proxy-setting" placeholder="http://proxy:port" />
            </div>
            <button id="save-settings-btn" class="btn btn-primary">Save Settings</button>
          </div>
        </div>
      </div>

      <!-- Active Session Modal -->
      <div id="active-session-modal" class="modal hidden">
        <div class="modal-content session-modal-content">
          <button class="modal-close">&times;</button>
          <div class="session-modal-header">
            <div class="session-icon"><i data-lucide="play"></i></div>
            <h2>Active Session Detected</h2>
          </div>
          <p class="session-modal-description">You have a running GeForce NOW session. To connect from this client, close any browser tabs or other clients streaming this session first.</p>
          <div class="session-info-card">
            <div class="session-info-row">
              <span class="session-label">Game:</span>
              <span class="session-value" id="active-session-game">--</span>
            </div>
            <div class="session-info-row">
              <span class="session-label">GPU:</span>
              <span class="session-value" id="active-session-gpu">--</span>
            </div>
            <div class="session-info-row">
              <span class="session-label">Resolution:</span>
              <span class="session-value" id="active-session-resolution">--</span>
            </div>
            <div class="session-info-row">
              <span class="session-label">Server:</span>
              <span class="session-value" id="active-session-server">--</span>
            </div>
          </div>
          <div class="session-modal-actions">
            <button id="connect-session-btn" class="btn btn-primary btn-large">Connect to Session</button>
            <button id="terminate-session-btn" class="btn btn-secondary">End Session</button>
            <button id="dismiss-session-btn" class="btn btn-ghost">Dismiss</button>
          </div>
        </div>
      </div>

      <!-- Session Conflict Modal (when trying to start a new game while session is running) -->
      <div id="session-conflict-modal" class="modal hidden">
        <div class="modal-content session-modal-content">
          <button class="modal-close">&times;</button>
          <div class="session-modal-header">
            <div class="session-icon warning"><i data-lucide="alert-triangle"></i></div>
            <h2>Session Already Running</h2>
          </div>
          <p class="session-modal-description">You already have an active session. Do you want to terminate it and start a new game?</p>
          <div class="session-info-card">
            <div class="session-info-row">
              <span class="session-label">Current Game:</span>
              <span class="session-value" id="conflict-session-game">--</span>
            </div>
            <div class="session-info-row">
              <span class="session-label">GPU:</span>
              <span class="session-value" id="conflict-session-gpu">--</span>
            </div>
          </div>
          <div class="session-modal-actions">
            <button id="terminate-and-launch-btn" class="btn btn-primary btn-large">Terminate & Launch New Game</button>
            <button id="cancel-launch-btn" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Update Modal -->
      <div id="update-modal" class="modal hidden">
        <div class="modal-content update-modal-content">
          <button class="modal-close">&times;</button>
          <div class="update-header">
            <i data-lucide="download" class="update-icon"></i>
            <h2>Update Available</h2>
          </div>
          <p class="update-version">A new version of OpenNOW is available: <span id="update-version"></span></p>
          <div class="update-changelog">
            <h3>Changelog</h3>
            <div id="update-changelog-content"></div>
          </div>
          <div class="update-actions">
            <a id="update-download-btn" href="#" target="_blank" class="btn btn-primary btn-large">Download Update</a>
            <button id="update-skip-btn" class="btn btn-secondary">Skip This Version</button>
            <button id="update-later-btn" class="btn btn-ghost">Remind Me Later</button>
          </div>
        </div>
      </div>

      <!-- Status Bar -->
      <footer id="status-bar">
        <div class="status-left">
          <span id="connection-status">‚óè Connected</span>
        </div>
        <div class="status-right">
          <span id="server-info">Server: Auto</span>
          <span id="ping-info">Ping: --ms</span>
        </div>
      </footer>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
